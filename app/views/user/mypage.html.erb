

<html>
<body>
  <!-- Header -->
  <header class="bg-info py-5 mb-5">
    <div class="container h-100">
      <div class="h-100 align-items-center">
        <div class="col-lg-12">
          <h1 class="display-5 text-white mt-1 mb-1">ここは<%= @user_name %>さんの詳細設定画面です</h1>
          <p class="text-white">グループで使用する趣味や名前の設定ができます。</p>
        </div>
      </div>
    </div>
  </header>

  <div class="container main">

    <div class="row">
      <div class="col-md-8 mb-5">
        <h3>所属グループ:<%= @group_name %></h3>
        <% if @users_hobbies.empty? %>
        <button class="btn btn-secondary btn-bg" type="button" onclick="">まだ趣味が登録されていません</button>
        <button class="btn btn-primary btn-bg" type="button" onclick="location.href='/group/list/<%= @group_token %>'">メンバーリスト<i class="fas fa-users"></i></button>
        <% else %>

        <button class="btn btn-success btn-bg" type="button" onclick="location.href='/user/show/<%=@user_token%>'">同じ趣味を持つ人を探す</button>
        <button class="btn btn-primary btn-bg" type="button" onclick="location.href='/group/list/<%= @group_token %>'">メンバーリスト<i class="fas fa-users"></i></button>

        <% end %>
        <hr>
        <h4>趣味の登録</h4>
        <p>ここで共有したい趣味を登録することができます。</p>
        <%= form_tag("/user/newhobby") do %>
        <div class="input-group" style="max-width:400px;">
          <input name="hobby_name" class="form-control" required>
          <input type="hidden" name="user_id" value="<%= @user_id %>">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="submit">登録</button>
          </span>
        </div>
        <% end %>
        <br>

        <!-- ここにユーザが登録してある趣味を全て表示する -->
        <ul class="list-inline mt-2">
        <% @users_hobbies.each_with_index {|hobby,i| %>
          <div class="box8">
          <li>
            <!-- 趣味の削除ボタン -->
            <li class="list-inline-item">
              <%= form_tag("/user/hobby_delete") do %>
              <input type="hidden" name="user_id" value="<%= @user_id %>">
              <input type="hidden" name="hobby_id" value="<%= hobby.id %>">
              <button class="btn btn-light btn-sm" type="submit" onclick="return subcheck()"><i class="far fa-trash-alt"></i></button>
              |
              <% end %>
            </li>
          <li class="list-inline-item">
            <%= "#{hobby.hobby_name}" %>
          </li>
          <!-- 趣味の表記揺れ対策登録ボタン -->
          <li class="list-inline-item" onclick="<%="entrySimilarHobby(#{i})"%>">
            <button class="btn btn-primary btn-sm">別名の登録</button>
          </li>

          <% if !@has_alias[i] #趣味の別名が無い場合 %>
          <!-- 趣味の表記揺れ対策登録隠しフォーム -->
          <div id="<%="regist_hidden#{i}"%>" style="display: none;">
            <li class="pl-5">
              <%= form_tag("/user/similar_hobby") do %>
              <input type="hidden" name="user_id" value="<%= @user_id %>">
              <input type="hidden" name="hobby_id" value="<%= hobby.id %>">
              <input name="similar_hobby_name">
              <input class="btn btn-primary btn-sm" type="submit" value="追加">
              <% end %>
          </div>

          <% else #趣味の別名がある場合 %>
            <li>
              <% alias_names = @alias_names_queue.shift %>
              <% alias_ids = @alias_ids_queue.shift %>
                <% alias_names.each_with_index do |alias_name, index| %>
                <li class="list-inline-item pl-2">
                  ＿＿
                </li>
                <!-- 趣味の別名の削除ボタン -->
                <li class="list-inline-item">
                  <%= form_tag("/user/similar_hobby_delete") do %>
                  <input type="hidden" name="user_id" value="<%= @user_id %>">
                  <input type="hidden" name="similar_hobby_id" value="<%= alias_ids[index] %>">
                  <button class="btn btn-light btn-sm" type="submit" onclick="return subcheck()"><i class="far fa-trash-alt"></i></button>
                  |
                  <% end %>
                </li>
                <!-- 趣味の別名の表示 -->
                <li class="list-inline-item pl-2">
                <%=  alias_name %>
                </li>
                <br>

                <% end %>
          <div id="<%="regist_hidden#{i}"%>" style="display: none;">
          <li class="pl-5">
              <%= form_tag("/user/similar_hobby_add") do %>
              <input type="hidden" name="user_id" value="<%= @user_id %>">
              <input type="hidden" name="hobby_id" value="<%= hobby.id %>">
              <input name="similar_hobby_name">
              <input class="btn btn-primary btn-sm" type="submit" value="追加">
              <% end %>
          </div>
          <% end %>

          </div>
        <% } %>

        </ul>
          <p><br>共有したい趣味が思いつかない場合は、下のメニューから自分の趣味と合うものを選んでください。</p>

          <%= form_tag("/user/newhobby") do %>
          <select name="hobby_name" style="max-width:80%;" required>
            <option value="">おすすめ趣味一覧</option>
            <% @dummy_hobbies.each do |hobby| %>
            <option value="<%= "#{hobby.hobby_name}" %>"><%= "#{hobby.hobby_name}" %></option>
            <% end %>
          </select>
          <input type="hidden" name="user_id" value="<%= @user_id %>">
          <input class="btn btn-primary btn-sm" type="submit" value="登録">
        <% end %>

        <hr>

          <h4>ユーザー情報の登録</h4>
          <p>趣味が一致したメンバーに公開する情報を追加できます</p>
          <% if @user_intro %>
          <div class="card border-success bg-light mb-3" style="max-width: 30rem; min-width: 12rem;">
            <div class="card-body"><%= simple_format(html_escape(@user_intro)) %><ul style="list-style: none; padding-left: 0;">
            </ul></div>
          </div>
          <% end %>
          <%= form_tag("/user/userintro") do %>
          <textarea name="user_intro" class="form-control" placeholder="趣味用のTwitterIDなどの情報を自由に入力"></textarea>
          <input type="hidden" name="user_id" value="<%= @user_id %>">
          <input class="btn btn-primary btn-bg" type="submit" value="登録">
          <% end %>
          <hr>

        <!-- ユーザー名の変更 -->
        <h4>名前の設定</h4>
        <p>
          グループ内で使用する名前を変更することができます。<br>
          （アカウントの名前を変更するわけではありません）
        </p>
        <%= form_tag("/user/name_change") do %>
        <div class="input-group" style="max-width:400px;">
          <input name="user_name" class="form-control" required>
          <input type="hidden" name="user_id" value="<%= @user_id %>">
          <span class="input-group-btn">
            <button class="btn btn-primary btn-bg" type="submit">変更</button>
          </span>
        </div>
        <% end %>
        <hr>

        <!--ユーザーの削除 -->
        <h4>このユーザーを削除する</h4>
        <%= form_tag("/user/delete") do %>
        <input type="hidden" name="user_id" value="<%= @user_id %>">
        <input class="btn btn-primary btn-bg" type="submit" value="削除" onclick='return subcheck_name("<%= @user_name %>")'>
        <% end %>
      </div>
    </div>
  </div>
</body>
</html>
